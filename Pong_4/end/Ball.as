package  {	import flash.geom.Point;	import flash.display.MovieClip;	import flash.events.Event;	import GameEvent;		public class Ball extends MovieClip{		public var vector:Point;		public var speed:Number;		public var court:MovieClip;		public var courtHeight:Number;		public var courtWidth:Number;				public function Ball(x:int, y:int, speed:Number, court:MovieClip) {			// constructor code			this.vector= new Point();			this.x = x;			this.y = y;			this.courtWidth = court.width;			this.courtHeight = court.height;			this.court = court;			this.speed=speed;		}		public function init():void {			//void			this.stage.addEventListener(Event.ENTER_FRAME, checkLoop);		}				public function destroy():void {						this.stage.removeEventListener(Event.ENTER_FRAME, checkLoop);		}		public function checkLoop(event:Event) {			checkCollision();			moveBall();		}						public function get nextPosition():Point {			var nextPoint:Point = new Point();			nextPoint.x = this.vector.x * this.speed + this.x;			nextPoint.y = this.vector.y * this.speed + this.y;			return nextPoint;		}					public function pushBall(v:Point):void {		this.vector = v;		}				public function moveBall():void {			this.x += this.vector.x * this.speed;			this.y += this.vector.y * this.speed;		}				public function checkCollision():void {			var normal:Point;			trace(this.y + 0.5 * this.height);			trace(this.courtHeight );			trace((this.y + 0.5 * this.height >= this.court.height).toString());			if (this.y - 0.5 * this.height <= 0) {				//bouncedown				this.y = this.height/2.0;				normal = new Point(0,1);				bounce(this.vector, normal);			}			else if (this.y + 0.5 * this.height >= this.courtHeight) {				//bounceup				this.y = this.courtHeight - this.height/2.0;				normal = new Point(0,-1);				bounce(this.vector, normal);			}			else if (this.x - 0.5 * this.width <= 0) {				// left side of court				this.x = this.width/2.0;				normal = new Point(1,0);				///bounce(this.vector, normal);				this.dispatchEvent(new GameEvent(GameEvent.SCORE_POINT));			}			else if (this.x + 0.5 * this.width >= this.courtWidth) {								//right side of the court				this.x = this.court.width - this.width/2.0;				normal = new Point(-1,0);				//bounce(this.vector,normal);				this.dispatchEvent(new GameEvent(GameEvent.SCORE_POINT));			}		}		public function bounce(v:Point, n:Point):void {			// R = V - 2 * (V · N)     			var d:Number = dot(v,n); 			var new_vec:Point =  new Point((v.x - 2 * d * n.x), (v.y - 2 * d * n.y));			this.vector = new_vec;		}				private function dot(v1:Point,v2:Point):Number {			return (v1.x*v2.x) + (v1.y*v2.y);		}	}	}